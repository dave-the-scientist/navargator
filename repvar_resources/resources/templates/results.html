<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Repvar results page">
    <meta name="author" content="Dave Curran">
    <title>Repvar results</title>
    <script src="static/libs/jquery-1.11.1.min.js"></script>
    <script src="static/libs/jquery-ui.min.js"></script>
    <script src="static/libs/sorttable.js"></script>
    <script src="static/libs/raphael-min.js"></script>
    <script src="static/libs/jsphylosvg-DC.js"></script>
    <script src="static/libs/svg-pan-zoom.min.js"></script>
    <script src="static/libs/d3.min.js"></script>
    <link rel="stylesheet" href="static/libs/jquery-ui.min.css">
    <link rel="stylesheet" href="static/libs/jquery-ui.theme.min.css">
    <script>
      var timestamp = +new Date;
      var core_css_url = 'static/css/core.css?v=' + timestamp;
      var page_css_url = 'static/css/results.css?v=' + timestamp;
      var icon_url = 'static/images/favicon.ico?v=' + timestamp;
      $('<link>')
        .appendTo('head')
        .attr({type : 'text/css', rel : 'stylesheet'})
        .attr('href', core_css_url);
      $('<link>')
        .appendTo('head')
        .attr({type : 'text/css', rel : 'stylesheet'})
        .attr('href', page_css_url);
      $('<link>')
        .appendTo('head')
        .attr({rel : 'icon'})
        .attr('href', icon_url);
    </script>
  </head>
  <body>
    <div id="errorDialog" title="Repvar error">
      <p id="errorDialogText">Error loading page resources.</p>
    </div>

    <div id="pageDiv">
      <div id="headerDiv">
        <div id="headerInnerDiv">
          <h1>Repvar results</h1>
          <p>Navbar and whatnot goes here.</p>
        </div>
      </div>

      <div id="bodyMainDiv">
        <div id="mainLeftDiv">
          <div id="summaryStatsDiv" class="style-box">
            <h2>Summary statistics</h2>
            <table id="summaryStatsTable" class="results-table"><tbody>
              <thead><tr>
                <th></th>
                <th>Count</th>
                <th>Average<br>distance</th>
              </tr></thead>
              <tr>
                <td>Clusters:</td>
                <td><span id="numClustersSpan">--</span></td>
                <td><span id="distClustersSpan">--</span></td>
              </tr>
              <tr>
                <td>Nodes:</td>
                <td><span id="numNodesSpan">--</span></td>
                <td><span id="distNodesSpan">--</span></td>
              </tr>
              <tr>
                <td><b>Total tree distance:</b></td>
                <td></td>
                <td><b><span id="distTotalSpan">--</span></b></td>
              </tr>
            </tbody></table>
          </div>

          <div id="displayOptionsDiv" class="style-box">
            <h2>Display options</h2>
            <label><input id="globalNormCheckbox" type="checkbox" />Normalize across runs</label>
            <p>Font sizes, colour pickers</p>
            <button id="redrawResultsButton" class="jq-ui-button">Redraw</button>
          </div>

          <div id="exportDataDiv" class="style-box">
            <h2>Export data</h2>
            <button id="exportRepsButton" class="jq-ui-button">Export representatives</button>
            <button id="exportClustersButton" class="jq-ui-button">Export clusters</button>
            <button id="exportSelectionButton" class="jq-ui-button">Export selection</button>
            <button id="exportTreeButton" class="jq-ui-button">Export tree image</button>
          </div>
        </div>

        <div id="mainTreeDiv" class="style-box">
          <h2>Phylogenetic tree</h2>
          <form id="treeControlsDiv" onsubmit="return treeSearchFunction();">
            <button id="searchToSelectButton" class="control-element" type="button" style="display:none">Add to<br>selection</button>
            <label id="varSearchHitsText" class=""></label>
            <button id="varSearchButton" class="control-element control-pair-left"><span class="ui-icon ui-icon-search"></span></button><!-- Needed to remove whitespace between this and the button. Because the parent uses a display:inline. name="searchInput"
            --><input id="varSearchInput" class="control-element control-pair-right" size="18" placeholder=" Search variants" onkeyup="this.setAttribute('value', this.value);" value="" />
            <button id="clearVarSearchButton" type="reset"><span class="ui-icon ui-icon-close"></span></button>
            <div style="clear:both;"></div>
            <button id="treeZoomOutButton" class="control-element control-pair-left" type="button"><span class="ui-icon ui-icon-minus"></button><!--
            --><button id="treeZoomInButton" class="control-element" type="button"><span class="ui-icon ui-icon-plus"></button>
            <button id="treeZoomResetButton" class="control-element control-pair-right" type="button">Reset</button>
            <button id="scrollZoomButton" class="control-element" type="button"><span id="scrollZoomText">Scroll<br>Zoom</span><span id="scrollZoomStatus">Off</span></button>
          </form>
          <svg id="figureSvg" xmlns="http://www.w3.org/2000/svg" version="1.1">
            <g id="treeGroup" class="svg-pan-zoom_viewport"></g>
          </svg>
          <div id="svgCanvas"></div>
        </div>

        <div id="mainRightDiv">
          <div id="selectionDiv" class="style-box">
            <h2>Distance to nearest chosen node</h2>
            <svg id="histoSvg" xmlns="http://www.w3.org/2000/svg" version="1.1"></svg>
            <div id="histoSlider">
              <div id="histoSliderHandle" class="ui-slider-handle"></div>
            </div>
            <div id="histoButtonsDiv">
              <button id="leftSliderButton" class="control-element">Add to<br>selection</button>
              <span id="numSliderSpan">-- nodes</span>
              <button id="middleSliderButton" class="control-element"><span id="midLeftArrow">&lt;&lt;</span><span id="middleSliderButtonSpan">Nodes<br>below</span><span id="midRightArrow">&gt;&gt;</span></button>
              <button id="rightSliderButton" class="control-element">Reset</button>
            </div>

            <h2>Selected nodes</h2>
            <p>Currently selected nodes: <span id="currentSelectionNum">0</span></p>
            <button id="selectAllButton" class="jq-ui-button">Select all</button>
            <button id="clearSelectionButton" class="jq-ui-button">Clear selection</button>
            <div id="colourSelectionDiv">
              <label for="colourBySelect">Colour selection by:</label>
              <select id="colourBySelect" onchange="colourSelectionChange(this.value)">
                <option value="custom" selected >Custom</option>
                <option value="distance">Distance</option>
                <option value="threshold">Threshold</option>
              </select>
            </div>
            <button id="clearColoursButton" class="jq-ui-button">Clear all colours</button>
          </div>

          <div id="clustersListDiv" class="style-box">
            <h2><span id="numClustersH2Span">--</span> clusters</h2>
            <table id="clustersListTable" class="sortable results-table">
              <thead>
                <tr>
                  <th>Variant</th>
                  <th class="sorttable_numeric">Size</th>
                  <th class="sorttable_numeric">Average<br>distance</th>
                  <th class="sorttable_numeric">90th<br>percentile</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

      </div>

      <div id="footerDiv">
        <p>&copy; 2018 David Curran</p>
      </div>
    </div>

    <script>
      /*
      var timestamp = +new Date;
      var core_js_url = "static/js/core.js?t=" + timestamp;
      var core_tree_js_url = "static/js/core_tree_functions.js?t=" + timestamp;
      var page_js_url = "static/js/results.js?t=" + timestamp;
      $.getScript(core_js_url, function() { console.log('loaded core.js'); });
      $.getScript(core_tree_js_url, function() { console.log('loaded core_tree_functions.js'); });
      $.getScript(page_js_url, function() { console.log('loaded results.js'); });
      */
      // Using $.getScript is async, and you can't ensure the order is maintained. This does:
      var scripts = ["static/js/core.js", "static/js/core_tree_functions.js", "static/js/results.js"];
      for (var i=0; i<scripts.length; ++i) {
        $.ajax({
          url:scripts[i], async:false, cache:false, dataType:'script',
          success: function() { console.log('loaded '+scripts[i]); },
          error: function(e) { console.log('error loading '+scripts[i], e); }
        });
      }
      // Could replace with a standard script call, but then you can't prevent caching.
    </script>
  </body>
</html>
