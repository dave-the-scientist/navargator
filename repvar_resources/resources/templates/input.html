<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Repvar input page">
    <meta name="author" content="Dave Curran">
    <title>NaVARgator input page</title>
    <script src="static/libs/jquery-1.11.1.min.js"></script>
    <script src="static/libs/jquery-ui.min.js"></script>
    <script src="static/libs/raphael-min.js"></script>
    <script src="static/libs/jsphylosvg-DC.js"></script>
    <script src="static/libs/svg-pan-zoom.min.js"></script>
    <script src="static/libs/d3.min.js"></script>
    <link rel="stylesheet" href="static/libs/jquery-ui.min.css">
    <link rel="stylesheet" href="static/libs/jquery-ui.theme.min.css">
    <script>
      var timestamp = +new Date;
      var core_css_url = 'static/css/core.css?v=' + timestamp;
      var page_css_url = 'static/css/input.css?v=' + timestamp;
      var icon_url = 'static/images/favicon.ico?v=' + timestamp;
      $('<link>')
        .appendTo('head')
        .attr({type : 'text/css', rel : 'stylesheet'})
        .attr('href', core_css_url);
      $('<link>')
        .appendTo('head')
        .attr({type : 'text/css', rel : 'stylesheet'})
        .attr('href', page_css_url);
      $('<link>')
        .appendTo('head')
        .attr({rel : 'icon'})
        .attr('href', icon_url);
    </script>
  </head>
  <body>
    <div id="errorDialog" title="Repvar error">
      <p id="errorDialogText">Error loading page resources.</p>
    </div>

    <div id="pageDiv">
      <div id="headerDiv">
        <div id="headerInnerDiv">
          <h1 title="NaVARgator">NaVARgator</h1>
          <p>Navbar and whatnot goes here.</p>
        </div>
      </div>

      <div id="bodyMainDiv">
        <div id="mainLeftDiv">
          <div id="inputOptionsDiv" class="style-box">
            <h2 id="loadInputHeader" class="collapsible-header">Load input file</h2>
            <div class="collapsible-panel">
              <form id="uploadFilesForm" method="post" enctype="multipart/form-data">
                <input id="uploadFileInput" name="upload-file" type="file">
              </form>
              <select id="uploadFileTypeSelect">
                <option disabled selected>Choose file type</option>
                <option value="nvrgtr">NaVARgator file</option>
                <option value="newick">Newick tree</option>
                <option value="phyloxml">PhyloXML tree</option>
              </select>
              <button id="uploadFileButton" class="jq-ui-button"><b>Load file</b></button>
              <hr>
            </div>
            <h2 class="collapsible-header">Display options</h2>
            <div class="collapsible-panel">
              <label><input id="showNamesCheckbox" type="checkbox" checked />Show variant names</label>
              <hr>
            </div>
            <button id="saveRepvarButton" class="jq-ui-button">Save session file</button>
          </div>

          <div id="runOptionsDiv" class="style-box">
            <h2>Results normalization</h2>
            <table><tbody>
              <tr><td>
                <label class="nvrgtr-checkbox-label"><input id="normSelfRadio" type="radio" name="normalizeRadios" checked />Self-normalized</label>
              </td></tr>
              <tr><td>
                <label class="nvrgtr-checkbox-label"><input id="normGlobalRadio" type="radio" name="normalizeRadios" />Normalize across runs <span id="normGlobalValSpan"></span></label>
              </td></tr>
              <tr><td>
                <label class="nvrgtr-checkbox-label"><input id="normValRadio" type="radio" name="normalizeRadios" />Normalize to</label>
                <input id="normValInput" placeholder="value" />
                <button id="normValGoButton" style="display:none">Ok</button>
              </td></tr>
            </tbody></table>
            <h2>Run options</h2>
            <div class="toggle-button-container">
              <input type="radio" id="singleRunCheckbox" name="run-type-choice" class="toggle-button-input" checked>
              <label for="singleRunCheckbox" id="singleRunLabel" class="toggle-button-label toggle-button-label-left">Single run</label>
              <input type="radio" id="multipleRunCheckbox" name="run-type-choice" class="toggle-button-input">
              <label for="multipleRunCheckbox" id="multipleRunLabel" class="toggle-button-label toggle-button-label-right">Variant range</label>
            </div>
            <table><tbody>
              <tr><td>
                <label for="numVarSpinner">Variants to find:</label>
                <input id="numVarSpinner" class="param-spinner" />
                <span class="multiple-run-only">to</span>
                <input id="rangeSpinner" class="param-spinner" />
              </td></tr>
              <tr><td>
                <label class="single-run-only nvrgtr-checkbox-label"><input id="autoOpenCheckbox" type="checkbox" checked />Auto-open results page</label>
              </td></tr>
              <tr><td>
                <label for="clustMethodSelect">Clustering method</label>
                <select id="clustMethodSelect">
                  <option value="k medoids" selected>K medoids</option>
                  <option value="brute force">Brute force</option>
                </select>
              </td></tr>
            </tbody></table>
            <button id="findVariantsButton" class="jq-ui-button"><b>Find variants</b></button>
          </div>

          <div id="resultsLinksDiv" class="style-box" style="display:none">
            <h2>Clustering results</h2>
            <svg id="scoreGraphSvg" style="display:none" xmlns="http://www.w3.org/2000/svg" version="1.1"></svg>
            <ul id="resultsLinksList" />
          </div>
        </div>

        <div id="mainTreeDiv" class="style-box">
          <div id="treeControlsDiv" class="tree-control-div" style="display:none">
            <form class="tree-control-row" onsubmit="return treeSearchFunction();">
              <button id="varSearchButton" class="control-element control-pair-left"><span class="ui-icon ui-icon-search"></span></button>
              <input id="varSearchInput" class="control-element control-pair-right" size="18" placeholder=" Search variants" onkeyup="this.setAttribute('value', this.value);" value="" autocomplete="off" />
              <button id="clearVarSearchButton" class="control-element" type="reset">&#10006;</button>
              <label id="varSearchHitsText"></label>
              <button id="searchToSelectButton" class="control-element" type="button" style="display:none">Add to<br>selection</button>
            </form>
            <div class="tree-control-row">
              <button id="treeZoomOutButton" class="control-element control-pair-left" type="button">&#10134;</button>
              <button id="treeZoomInButton" class="control-element" type="button">&#10133;</button>
              <button id="treeZoomResetButton" class="control-element control-pair-right" type="button">Reset</button>
              <button id="scrollZoomButton" class="control-element" type="button"><span id="scrollZoomText">Scroll<br>Zoom</span><span id="scrollZoomStatus">Off</span></button>
            </div>
          </div>

          <div id="treeSelectionDiv" class="tree-control-div" style="display:none">
            <div class="tree-control-row-rj">
              <label id="currentSelectionLabel" class="control-element control-pair-left control-pair-right prevent-text-selection">Selected variants: <span id="currentSelectionNum">0</span></label>
            </div>
            <div class="tree-control-row-rj">
              <div id="selectNamesGroupDiv">
                <button id="selectNamesButton" class="control-element">Select<br>by name</button>
                <div id="selectNamesPane">

                  <div id="selectNamesHeaderDiv">
                    <h2 id="selectNamesHeader">Select variants by name</h2>
                    <button id="selectNamesHideButton"><span id="selectNamesHideSpan1"></span><span id="selectNamesHideSpan2"></span></button>
                  </div>

                  <div id="selectNamesMainDiv">
                    <div id="selectNamesLeftColumn">
                      <!--<p><b>Select variants by name</b></p>-->
                      <textarea id="selectNamesText" placeholder="Enter variant names"></textarea>
                      <button id="selectNamesAddButton" class="control-element">Add to selection</button>
                    </div>
                    <div id="selectNamesRightColumn">
                      <!--<button id="selectNamesHideButton" class="control-element">Hide</button>-->
                      <button id="selectNamesValidateButton" class="control-element">Validate</button>
                      <button id="selectNamesClearButton" class="control-element">Clear</button>
                    </div>
                  </div>

                </div>
              </div>
              <button id="selectAllButton" class="control-element control-pair-left">Select all</button>
              <button id="clearSelectionButton" class="control-element control-pair-right">Clear</button>
            </div>
          </div>
          <svg id="figureSvg" xmlns="http://www.w3.org/2000/svg" version="1.1">
            <g id="introMessageGroup">
              <text x="10" y="20" style="font-size:25px; font-family:Helvetica,Arial,sans-serif">Welcome to NaVARgator! To get started:
                <tspan x="20" y="50" style="font-size:17px">Choose a phylogenetic tree or a previously saved .nvrgtr session file.</tspan>
                <tspan x="20" y="80" style="font-size:17px">Press "Load file".</tspan>
              </text>
            </g>
            <g id="treeGroup" class="svg-pan-zoom_viewport"></g>
          </svg>
          <div id="svgCanvas"></div>
        </div>

        <div id="mainVariantSelectDiv" class="style-box" style="display:none">
          <h2>Assigned variants</h2>
          <div id="varSelectDiv">
            <div id="varAssignTableDiv">
              <table id="varAssignTable"><tbody>
                <tr>
                  <td><div id="availAssignedDiv" class="var-assigned-div prevent-text-selection"><label class="var-assigned-label"><span id="numAvailSpan">0</span> available variants</label><label id="addAvailButton" class="var-assigned-add"><span class="var-assigned-add-span1"></span><span class="var-assigned-add-span2"></span></label><span class="var-assigned-sep"></span><label id="clearAvailButton" class="var-assigned-clear" title="Clear 'available variants'."><span class="var-assigned-clear-span1"></span><span class="var-assigned-clear-span2"></span></label></div></td>
                </tr>
                <tr>
                  <td><div id="chosenAssignedDiv" class="var-assigned-div prevent-text-selection"><label class="var-assigned-label"><span id="numChosenSpan">0</span> chosen variants</label><label id="addChosenButton" class="var-assigned-add"><span class="var-assigned-add-span1"></span><span class="var-assigned-add-span2"></span></label><span class="var-assigned-sep"></span><label id="clearChosenButton" class="var-assigned-clear" title="Clear 'chosen variants'."><span class="var-assigned-clear-span1"></span><span class="var-assigned-clear-span2"></span></label></div></td>
                </tr>
                <tr>
                  <td><div id="ignoredAssignedDiv" class="var-assigned-div prevent-text-selection"><label class="var-assigned-label"><span id="numIgnoredSpan">0</span> ignored variants</label><label id="addIgnoredButton" class="var-assigned-add"><span class="var-assigned-add-span1"></span><span class="var-assigned-add-span2"></span></label><span class="var-assigned-sep"></span><label id="clearIgnoredButton" class="var-assigned-clear" title="Clear 'ignored variants'."><span class="var-assigned-clear-span1"></span><span class="var-assigned-clear-span2"></span></label></div></td>
                </tr>
              </tbody></table>
            </div>
            <p id="varSelectHeader"><b><span id="numVariantsSpan"></span> total variants:</b></p>
            <div style="clear:right;"></div>
          </div>
        </div>
      </div>

      <div id="footerDiv">
        <p>&copy; 2018 David Curran</p>
      </div>
    </div>

    <script>
      // Using $.getScript is async, and you can't ensure the order is maintained. This does:
      var scripts = ["static/js/core.js", "static/js/core_tree_functions.js", "static/js/input.js"];
      for (var i=0; i<scripts.length; ++i) {
        $.ajax({
          url:scripts[i], async:false, cache:false, dataType:'script',
          success: function() { console.log('loaded '+scripts[i]); },
          error: function(e) { console.log('error loading '+scripts[i], e); }
        });
      }
      // Could replace with a standard script call, but then you can't prevent caching.
    </script>
  </body>
</html>
